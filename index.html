<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dato Apuesta âš½ Agenda de Hoy</title>
<style>
body { font-family:"Poppins",sans-serif; background:#0b0c10; color:#fff; margin:0; padding:0; }
header { background:#1f2833; padding:15px 20px; display:flex; justify-content:space-between; align-items:center; }
header h1 { margin:0; font-size:1.6em; letter-spacing:1px; }
nav a { color:#66fcf1; text-decoration:none; font-weight:600; margin-left:20px; }
nav a:hover { color:#45a29e; }

.league { margin:20px auto; width:90%; background:#171a21; border-radius:12px; padding:12px 20px; box-shadow:0 0 10px rgba(255,255,255,0.05);}
.league h2 { text-transform:uppercase; margin:5px 0 12px; font-size:1.25em; }
.match { background:#222831; padding:12px; border-radius:10px; margin:10px 0; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; transition:0.2s; }
.match span { display:block; margin:3px 0; }
.match:hover { background:#2e333f; }

button { background:#45a29e; color:#fff; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; font-weight:600; transition:0.2s; }
button:hover { background:#66fcf1; color:#000; }

.modal { display:none; position:fixed; z-index:10; left:0; top:0; width:100%; height:100%; background-color: rgba(0,0,0,0.8); justify-content:center; align-items:center; }
.modal-content { background:#1f2833; border-radius:15px; padding:20px; width:90%; max-width:450px; text-align:left; }
.modal-content h3 { margin-top:0; }
.close { background:#c3073f; float:right; padding:5px 10px; border-radius:6px; cursor:pointer; }

/* Mobile responsive */
@media (max-width: 768px) {
    header { flex-direction: column; align-items: flex-start; padding: 10px; }
    header h1 { font-size: 1.3em; margin-bottom: 5px; }
    nav a { margin-left: 0; margin-right: 15px; display:inline-block; margin-bottom:5px; }
}
</style>
</head>
<body>

<header>
<h1>Dato Apuesta âš½ Agenda de Hoy</h1>
<nav>
  <a href="live.html">Ver FÃºtbol en Vivo</a>
</nav>
</header>

<div id="matches"></div>

<div id="statsModal" class="modal">
<div class="modal-content">
<button class="close" onclick="closeModal()">Cerrar</button>
<h3 id="modalTitle">EstadÃ­sticas del Partido</h3>
<div id="modalBody">Cargando...</div>
</div>
</div>

<script>
const API_KEY = "58587099b74e80acd927232e2fbf71df";
const matchesDiv = document.getElementById("matches");
const ligasPermitidas = ["Serie A","Serie B","Ligue 1","Serie A2","Primera Division","Premier League","La Liga","Bundesliga"];

async function getMatches(){
  try{
    const today = new Date().toISOString().split("T")[0];
    const res = await fetch(`https://v3.football.api-sports.io/fixtures?date=${today}`,{
      headers: { "x-apisports-key": API_KEY }
    });
    const data = await res.json();

    const filtered = data.response.filter(m => ligasPermitidas.includes(m.league.name));

    const grouped = {};
    filtered.forEach(m=>{
      const country = m.league.country || "Other";
      if(!grouped[country]) grouped[country]=[];
      grouped[country].push(m);
    });

    matchesDiv.innerHTML="";
    const now = new Date();
    for(const country in grouped){
      const div=document.createElement("div");
      div.className="league";
      div.innerHTML=`<h2>${country}</h2>`;
      grouped[country].forEach(m=>{
        const match=document.createElement("div");
        const utcDate=new Date(m.fixture.date);
        const localTime=new Intl.DateTimeFormat("es-AR",{hour:"2-digit",minute:"2-digit",hour12:false}).format(utcDate);
        match.className="match";
        match.innerHTML=`
          <div>
            <span><b>${m.teams.home.name}</b> vs <b>${m.teams.away.name}</b></span>
            <span>${localTime} hrs</span>
            <span>${m.league.name}</span>
          </div>
          <button onclick="showStats(${m.teams.home.id},${m.teams.away.id},'${m.teams.home.name}','${m.teams.away.name}')">Ver estadÃ­sticas ðŸ“Š</button>
        `;
        div.appendChild(match);
      });
      matchesDiv.appendChild(div);
    }
  }catch(err){
    console.log(err);
    matchesDiv.innerHTML="<p>Error al cargar los partidos. Revisa tu API Key y la conexiÃ³n.</p>";
  }
}

async function showStats(homeId,awayId,homeName,awayName){
  document.getElementById("modalTitle").innerText=`${homeName} vs ${awayName}`;
  document.getElementById("modalBody").innerHTML="Cargando...";
  try{
    const res=await fetch(`https://v3.football.api-sports.io/fixtures/headtohead?h2h=${homeId}-${awayId}`,{
      headers:{"x-apisports-key":API_KEY}
    });
    const data=await res.json();
    if(!data.response || data.response.length===0){
      document.getElementById("modalBody").innerHTML="<p>No hay datos de enfrentamientos.</p>";
      return;
    }

    const ultimos=data.response.slice(0,5).map(f=>{
      const fecha=new Date(f.fixture.date).toLocaleDateString();
      return `${fecha} â†’ ${f.teams.home.name} ${f.goals.home}-${f.goals.away} ${f.teams.away.name}`;
    }).join("<br>");

    function getForm(teamId){
      const ultimos5=data.response.filter(d=>d.teams.home.id===teamId || d.teams.away.id===teamId).slice(0,5);
      return ultimos5.map(g=>{
        const esHome=g.teams.home.id===teamId;
        const goles=esHome?[g.goals.home,g.goals.away]:[g.goals.away,g.goals.home];
        if(goles[0]>goles[1]) return "ðŸŸ¢";
        else if(goles[0]===goles[1]) return "ðŸŸ¡";
        else return "ðŸ”´";
      }).join("");
    }

    document.getElementById("modalBody").innerHTML=`
      <p><b>Ãšltimos enfrentamientos:</b><br>${ultimos}</p>
      <p><b>Racha reciente:</b><br>${homeName}: ${getForm(homeId)}<br>${awayName}: ${getForm(awayId)}</p>
    `;
  }catch(err){
    console.log(err);
    document.getElementById("modalBody").innerHTML="<p>Error al cargar estadÃ­sticas.</p>";
  }
  document.getElementById("statsModal").style.display="flex";
}

function closeModal(){ document.getElementById("statsModal").style.display="none"; }

getMatches();
</script>
</body>
</html>
